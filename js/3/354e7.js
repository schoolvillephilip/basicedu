!function(e){"use strict";if(e(document).ready(function(){e.fn.lsvrTownpressDirectoryMap&&e("#lsvr_listing-map__canvas").each(function(){e(this).lsvrTownpressDirectoryMap()})}),!e.fn.lsvrTownpressDirectoryMap){var r,a={init:function(){e.fn.lsvrTownpressLoadGoogleMapsApi&&e.fn.lsvrTownpressLoadGoogleMapsApi();var r=e(this),a=r.data("maptype")?r.data("maptype"):"terrain",t=r.data("zoom")?r.data("zoom"):17,s=!(!r.data("mousewheel")||!0!==String(r.data("mousewheel"))),o=r.attr("id"),n=r.data("query")?r.data("query"):{},i=function(){switch(a){case"roadmap":a=google.maps.MapTypeId.ROADMAP;break;case"satellite":a=google.maps.MapTypeId.SATELLITE;break;case"hybrid":a=google.maps.MapTypeId.HYBRID;break;default:a=google.maps.MapTypeId.TERRAIN}var e={zoom:t,mapTypeId:a,scrollwheel:s};"undefined"!=typeof lsvr_townpress_google_maps_style_json?e.styles=JSON.parse(lsvr_townpress_google_maps_style_json):"undefined"!=typeof lsvr_townpress_google_maps_style?e.styles=lsvr_townpress_google_maps_style:e.styles=[{featureType:"poi",stylers:[{visibility:"off"}]}];var i=new google.maps.Map(document.getElementById(o),e);r.data("map",i);var l=[];r.data("mapMarkers",l);r.data("mapMarkerClusterer",!1),r.lsvrTownpressDirectoryMap("ajaxRequest",n)};"object"==typeof google&&"object"==typeof google.maps?i():e(document).on("lsvrTownpressGoogleMapsApiLoaded",function(){i()})},update:function(e){void 0!==e&&this.lsvrTownpressDirectoryMap("ajaxRequest",e)},ajaxRequest:function(e){if(void 0!==e){var a=this;"undefined"!=typeof lsvr_townpress_ajax_directory_map_var&&(void 0!==r&&r.abort(),r=jQuery.ajax({type:"post",dataType:"JSON",url:lsvr_townpress_ajax_directory_map_var.url,data:{action:"lsvr-townpress-ajax-directory-map",nonce:encodeURIComponent(lsvr_townpress_ajax_directory_map_var.nonce),query:e},success:function(e){a.lsvrTownpressDirectoryMap("refresh",e)}}))}},refresh:function(e){if("object"==typeof google&&"object"==typeof google.maps&&this.data("map")&&this.data("mapMarkers")){var r=this,a=r.data("map"),t=r.data("mapMarkers"),s=r.data("mapMarkerClusterer"),o=!!e.hasOwnProperty("locations")&&e.locations,n=!!e.hasOwnProperty("labels")&&e.labels,i=!!e.hasOwnProperty("markerclusterpath")&&e.markerclusterpath;if(!1!==o){!function(){if(o.length>0){1===o.length&&o[0].hasOwnProperty("latitude")&&o[0].hasOwnProperty("longitude")&&a.setOptions({center:new google.maps.LatLng(o[0].latitude,o[0].longitude)});var e={content:"",disableAutoPan:!1,maxWidth:0,pixelOffset:new google.maps.Size(-140,5),zIndex:null,boxStyle:{width:"280px"},closeBoxMargin:"10px 2px 2px 2px",closeBoxURL:"",infoBoxClearance:new google.maps.Size(1,1),isHidden:!1,pane:"floatPane",enableEventPropagation:!1},l=new InfoBox(e),p=!1;google.maps.event.addListener(l,"domready",function(){p=google.maps.event.addListener(a,"click",function(){l.close(),google.maps.event.removeListener(p)})});for(var m=new google.maps.LatLngBounds,d=0;d<t.length;d++)t[d].setMap(null);t=[];for(d=0;d<o.length;d++)if(o[d].hasOwnProperty("latitude")&&o[d].hasOwnProperty("longitude")){"function"==typeof RichMarker&&o[d].hasOwnProperty("thumburl")?t[d]=new RichMarker({position:new google.maps.LatLng(o[d].latitude,o[d].longitude),map:a,shadow:"none",content:'<div class="lsvr_listing-map__marker lsvr_listing-map__marker--has-thumb lsvr_listing-map__marker--id-'+o[d].id+'"><div class="lsvr_listing-map__marker-inner lsvr_listing-map__marker-inner--has-thumb" style="background-image: url(\''+o[d].thumburl+"');\"></div></div>"}):t[d]=new RichMarker({position:new google.maps.LatLng(o[d].latitude,o[d].longitude),map:a,shadow:"none",content:'<div class="lsvr_listing-map__marker lsvr_listing-map__marker--id-'+o[d].id+'"><div class="lsvr_listing-map__marker-inner"></div></div>'}),r.data("mapMarkers",t);var g="";if(o[d].hasOwnProperty("thumburl")?g+='<div class="lsvr_listing-map__infobox lsvr_listing-map__infobox--has-thumb">':g+='<div class="lsvr_listing-map__infobox">',g+='<div class="lsvr_listing-map__infobox-inner">',o[d].hasOwnProperty("thumburl")&&o[d].hasOwnProperty("permalink")&&(g+='<a href="'+o[d].permalink+'" class="lsvr_listing-map__infobox-thumb" style="background-image: url( \''+o[d].thumburl+"' ); \"></a>"),o[d].hasOwnProperty("title")&&o[d].hasOwnProperty("permalink")&&(g+='<h4 class="lsvr_listing-map__infobox-title">',g+='<a href="'+o[d].permalink+'" class="lsvr_listing-map__infobox-title-link">'+o[d].title,g+="</a></h4>"),o[d].hasOwnProperty("address")&&(g+='<p class="lsvr_listing-map__infobox-address">'+o[d].address.replace(/(?:\r\n|\r|\n)/g,"<br>")+"</p>"),o[d].hasOwnProperty("category")&&void 0!==n.marker_infowindow_cat_prefix){for(var _="",c=0;c<o[d].category.length;c++)o[d].category[c].hasOwnProperty("name")&&o[d].category[c].hasOwnProperty("url")&&(_+='<a href="'+o[d].category[c].url+'" class="lsvr_listing-map__infobox-category-link">'+o[d].category[c].name+"</a>",c<o[d].category.length-1&&(_+=", "));g+='<p class="lsvr_listing-map__infobox-category">'+n.marker_infowindow_cat_prefix.replace("%s",_)+"</p>"}void 0!==n.marker_infowindow_more_link&&o[d].hasOwnProperty("permalink")&&(g+='<p class="lsvr_listing-map__infobox-more"><a href="'+o[d].permalink+'" class="lsvr_listing-map__infobox-more-link">'+n.marker_infowindow_more_link+"</a></p>"),g+="</div></div>",t[d].infoboxContent=g,google.maps.event.addListener(t[d],"click",function(){!1!==p&&google.maps.event.removeListener(p),l.setContent(this.infoboxContent),l.open(a,this)}),o.length>1&&m.extend(t[d].position)}if("function"==typeof MarkerClusterer){!1!==s&&s.clearMarkers();var h=[{width:58,height:58,url:i+"markercluster1.png",textColor:"white",textSize:12},{width:58,height:58,url:i+"markercluster2.png",textColor:"white",textSize:12},{width:58,height:58,url:i+"markercluster3.png",textColor:"white",textSize:12},{width:58,height:58,url:i+"markercluster4.png",textColor:"white",textSize:12},{width:58,height:58,url:i+"markercluster5.png",textColor:"white",textSize:12}];s=new MarkerClusterer(a,t,{styles:h}),r.data("mapMarkerClusterer",s)}o.length>1&&a.fitBounds(m),r.removeClass("lsvr_listing-map__canvas--loading"),r.parent().find(".lsvr_listing-map__spinner").remove()}}()}else r.parent().hide()}}};e.fn.lsvrTownpressDirectoryMap=function(e){return a[e]?a[e].apply(this,Array.prototype.slice.call(arguments,1)):a.init.apply(this,arguments)}}}(jQuery);
;!function(a,b){"use strict";function c(){if(!e){e=!0;var a,c,d,f,g=-1!==navigator.appVersion.indexOf("MSIE 10"),h=!!navigator.userAgent.match(/Trident.*rv:11\./),i=b.querySelectorAll("iframe.wp-embedded-content");for(c=0;c<i.length;c++){if(d=i[c],!d.getAttribute("data-secret"))f=Math.random().toString(36).substr(2,10),d.src+="#?secret="+f,d.setAttribute("data-secret",f);if(g||h)a=d.cloneNode(!0),a.removeAttribute("security"),d.parentNode.replaceChild(a,d)}}}var d=!1,e=!1;if(b.querySelector)if(a.addEventListener)d=!0;if(a.wp=a.wp||{},!a.wp.receiveEmbedMessage)if(a.wp.receiveEmbedMessage=function(c){var d=c.data;if(d.secret||d.message||d.value)if(!/[^a-zA-Z0-9]/.test(d.secret)){var e,f,g,h,i,j=b.querySelectorAll('iframe[data-secret="'+d.secret+'"]'),k=b.querySelectorAll('blockquote[data-secret="'+d.secret+'"]');for(e=0;e<k.length;e++)k[e].style.display="none";for(e=0;e<j.length;e++)if(f=j[e],c.source===f.contentWindow){if(f.removeAttribute("style"),"height"===d.message){if(g=parseInt(d.value,10),g>1e3)g=1e3;else if(~~g<200)g=200;f.height=g}if("link"===d.message)if(h=b.createElement("a"),i=b.createElement("a"),h.href=f.getAttribute("src"),i.href=d.value,i.host===h.host)if(b.activeElement===f)a.top.location.href=d.value}else;}},d)a.addEventListener("message",a.wp.receiveEmbedMessage,!1),b.addEventListener("DOMContentLoaded",c,!1),a.addEventListener("load",c,!1)}(window,document);